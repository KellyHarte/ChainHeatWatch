# ChainHeatWatch 功能测试指南

## 📋 页面功能说明

### 1. 🏠 首页 (`/`)
**功能：**
- 显示你的总记录数、积分、全球活动统计
- 快速导航到各个功能页面
- 应用介绍和功能介绍

### 2. 🌡️ 提交页面 (`/submit`)
**功能：**
- 可视化温度计（实时显示温度值）
- 温度滑块（0-50°C）
- 心情选择（😊😰🥶🤒）
- 24小时冷却期倒计时
- 加密提交到区块链

**测试步骤：**
1. 确保钱包已连接
2. 拖动温度滑块选择温度（例如 25°C）
3. 选择一个心情表情
4. 点击 "🔥 Submit Log" 按钮
5. 确认 MetaMask 交易签名
6. 等待交易确认（会显示 "✅ Recorded successfully!"）

### 3. 📊 历史页面 (`/history`)
**功能：**
- 查看所有提交的历史记录
- 交互式温度趋势图（支持 7天/30天/1年切换）
- 本地解密功能（解密后显示实际温度值）
- 显示每条记录的日期、心情、温度

**测试步骤：**
1. 进入历史页面
2. 点击 "🔄 Refresh" 从链上获取最新日志
3. 点击 "🔓 Decrypt Locally" 解密数据
4. 查看解密后的温度值和趋势图
5. 切换时间段查看不同周期的数据

### 4. 📈 统计页面 (`/statistics`)
**功能：**
- 时间段筛选（7天/30天/365天）
- 统计卡片：平均值、最高值、最低值、记录数
- 温度趋势折线图
- 温度波动分析（标准差）

**测试步骤：**
1. 确保已有至少几条历史记录
2. 进入统计页面
3. 点击时间段按钮切换（7天/30天/365天）
4. 查看统计卡片显示的数据
5. 查看趋势图和波动分析

### 5. 🌍 全球趋势页面 (`/global`)
**功能：**
- 匿名全球平均温度
- 热浪警报（≥32°C时显示）
- 个人与全球平均值对比
- 隐私保护说明

**测试步骤：**
1. 进入全球趋势页面
2. 点击 "📈 Get Global Average" 按钮
3. 确认 MetaMask 交易签名（授权解密）
4. 查看全球平均温度
5. 如果有个人数据，会显示与全球平均值的对比

---

## 🧪 完整测试流程

### 准备阶段
1. **确保本地节点运行：**
   ```bash
   cd action/contracts
   npx hardhat node --verbose
   ```

2. **确保合约已部署：**
   ```bash
   cd action/contracts
   npx hardhat deploy --network localhost
   ```

3. **启动前端（如果未运行）：**
   ```bash
   cd action/frontend
   npm run dev:mock
   ```

4. **连接 MetaMask：**
   - 打开 http://localhost:3000
   - 点击 "Connect Wallet"
   - MetaMask 连接到 Localhost 8545 (chainId: 31337)

### 测试流程

#### 测试 1：提交第一条记录
1. 点击导航栏 "🌡️ Submit"
2. 拖动滑块到 28°C
3. 选择 😊 表情
4. 点击 "🔥 Submit Log"
5. **预期结果：** 显示成功动画，冷却期倒计时开始

#### 测试 2：查看历史记录
1. 点击导航栏 "📊 History"
2. 点击 "🔄 Refresh" 按钮
3. 点击 "🔓 Decrypt Locally" 按钮
4. **预期结果：** 显示解密后的温度 28°C，趋势图显示数据点

#### 测试 3：提交更多记录（模拟不同时间）
由于有 24 小时冷却期，你可以：
- **方案 A：** 等待 24 小时
- **方案 B：** 使用 Hardhat 任务提交（绕过冷却期检查）

```bash
cd action/contracts
# 使用不同的账户提交
npx hardhat task:submit --value 30 --mood "😰" --network localhost
```

#### 测试 4：查看统计页面
1. 点击导航栏 "📈 Statistics"
2. 切换到 "Last 7 Days"
3. **预期结果：** 显示平均值、最高值、最低值统计卡片
4. 查看趋势图和波动分析

#### 测试 5：查看全球趋势
1. 点击导航栏 "🌍 Global Trend"
2. 点击 "📈 Get Global Average"
3. 确认 MetaMask 交易
4. **预期结果：** 显示全球平均温度（如果有多人提交）

---

## ⚠️ 常见问题

### 问题 1：显示 "No data available"
**原因：** 还没有提交过任何记录
**解决：** 先去提交页面提交第一条记录

### 问题 2：解密失败
**原因：** 
- FHEVM 实例未初始化
- 钱包未连接
- 签名失败

**解决：**
- 检查状态栏是否显示 "ready"
- 确保钱包已连接
- 刷新页面重试

### 问题 3：24小时冷却期
**原因：** 合约限制每天只能提交一次
**解决：** 等待冷却期结束，或使用 Hardhat 任务提交

### 问题 4：全球平均显示 "n/a"
**原因：** 还没有人提交数据，或还未授权解密
**解决：** 点击 "Get Global Average" 按钮获取数据

---

## 🎯 快速测试检查清单

- [ ] 钱包连接成功
- [ ] FHEVM 状态显示 "ready"
- [ ] 成功提交第一条温度记录
- [ ] 历史页面能刷新并显示记录
- [ ] 历史页面能成功解密数据
- [ ] 统计页面显示统计数据
- [ ] 趋势图正常显示
- [ ] 全球趋势页面能获取平均值
- [ ] 24小时冷却期倒计时正常工作
- [ ] 导航栏切换页面正常

---

## 📝 测试建议

1. **提交多条记录：** 使用不同温度值和心情，测试数据展示
2. **测试时间段切换：** 在历史和统计页面测试不同时间段
3. **测试解密功能：** 确认加密数据能正确解密
4. **测试响应式：** 在不同屏幕尺寸下测试页面显示
5. **测试错误处理：** 故意断开钱包连接，查看错误提示

---

**提示：** 如果遇到 "Error: aborted" 错误，通常是 FHEVM 实例创建被中止。尝试刷新页面重新加载。





